pipeline {
  agent any

  stages {
    stage('Checkout') {
      steps {
        checkout scm
      }
    }

    // stage('Build') {
    //   steps {
    //     sh 'npm install'
    //   }
    // }

    // stage('Test') {
    //   steps {
    //     sh 'npm run test:ci'
    //   }
    // }

    stage('Test SSH Connection') {
      steps {
        withCredentials([sshUserPrivateKey(credentialsId: 'SSH_NEWBIE', keyFileVariable: 'SSH_KEY_FILE')]) {
          sh '''
            # Test SSH connection with specific parameters
            EC2_HOST="118.69.34.46"
            EC2_USER="newbie"
            EC2_PORT="3334"

            echo "=== TESTING SSH CONNECTION ==="
            echo "Host: $EC2_HOST"
            echo "User: $EC2_USER"
            echo "Port: $EC2_PORT"
            echo "================================"

            # Test SSH connection
            ssh -i "$SSH_KEY_FILE" -p $EC2_PORT -o StrictHostKeyChecking=no -o ConnectTimeout=10 $EC2_USER@$EC2_HOST "echo 'SSH connection successful!'; whoami; pwd; ls -la"

            echo "=== SSH TEST COMPLETED ==="
          '''
        }
      }
    }
  }
}
